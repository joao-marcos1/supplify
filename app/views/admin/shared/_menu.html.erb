<nav class='navbar navbar-default navbar-fixed-top' role="navigation">
  <div class="navbar-header">
    <%= link_to content_tag(:span, '', class: 'glyphicon glyphicon-home'), {controller: 'admin/dashboard'}, {class: "navbar-brand"} %>
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#sidebar-top">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
  </div>
  <div class="collapse navbar-collapse" id="sidebar-top">
    <ul class='nav navbar-nav'>
      <% if can? :index, 'admin/content' %>
        <li class='dropdown'>
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">
            <%= t('.articles') %>
            <b class="caret"></b>
          </a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
            <%= menu_item(t('.all_articles'), admin_content_index_path) %>
            <%= menu_item(t('.new_article'),  new_admin_content_path) %>
            <%= menu_item(t('.feedback'),     admin_feedback_index_path) %>
            <%= menu_item(t('.tags'),         admin_tags_path) %>
            <%= menu_item(t('.article_types'),admin_post_types_path) %>
            <%= menu_item(t('.redirects'),    admin_redirects_path) %>
          </ul>
        </li>
      <% end %>
      <% if can? :index, 'admin/pages' %>
        <li class='dropdown'>
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">
            <%= t('.pages') %>
            <b class="caret"></b>
          </a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
            <%= menu_item(t('.all_pages'), admin_pages_path) %>
            <%= menu_item(t('.new_page'),  new_admin_page_path) %>
          </ul>
        </li>
      <% end %>

      <% current_user.project_modules.each do |project_module| %>
        <% submenus = AccessControl.submenus_for(current_user.profile_label, project_module.name.to_sym) %>
        <% if submenus.size == 0 %>
          <%= content_tag(:li, link_to(project_module.menu_name, project_module.menu_url)) %>
        <% else %>
          <li class='dropdown'>
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
              <%= project_module.menu_name %>
              <b class="caret"></b>
            </a>
            <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
              <% submenus.each do |submenu| %>
                <% if current_page? submenu.url %>
                  <%= content_tag(:li, link_to(submenu.name, '#'), class: 'active') %>
                <% else %>
                  <%= content_tag(:li, link_to(submenu.name, submenu.url)) %>
                <% end %>
              <% end %>
            </ul>
          </li>
        <% end %>
      <% end %>
    </ul>
    <ul class='nav navbar-nav pull-right'>
      <li class='dropdown'>
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
          <%= t("admin.menu.logged_in_as", login: current_user.display_name) %>
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
          <li><%= link_to t("admin.menu.profile"), { :controller => 'admin/profiles', :action => 'index'}  %></li>
          <li role="presentation" class="divider"></li>
          <li><%= link_to t("admin.menu.documentation"), "https://github.com/fdv/publify/wiki" %></li>
          <li><%= link_to t("admin.menu.report_a_bug"), "https://github.com/fdv/publify/issues" %></li>
          <li><%= link_to t("admin.menu.in_page_plugins"), "https://github.com/fdv/publify/wiki/In-Page-Plugins" %></li>
          <li><%= link_to t("admin.menu.sidebar_plugins"), "https://github.com/fdv/publify/wiki/Sidebar-plugins" %></li>
          <li role="presentation" class="divider"></li>
          <li><%= link_to t("admin.menu.logout").html_safe, destroy_user_session_path, method: :delete %></li>
        </ul>
      </li>
    </ul>
    <ul class='nav navbar-nav pull-right'>
      <li class='dropdown'>
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
          <%= t(".new")%>
          <b class="caret"></b>
        </a>
        <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
          <li><%= link_to(t("admin.menu.new_article"), {controller: 'content', action: 'new'}) %></li>
          <li><%= link_to(t("admin.menu.new_page"), {controller: 'pages', actions: 'new'}) %></li>
          <li><%= link_to(t("admin.menu.new_media"), {controller: 'resources', action: 'index'}) %></li>
          <li><%= link_to(t("admin.menu.new_note"), {controller: 'notes'}) %></li>
        </ul>
      </li>
    </ul>
  </div>
</nav>
