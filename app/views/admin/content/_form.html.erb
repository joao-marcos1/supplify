<%= hidden_field_tag "user_textfilter", current_user.text_filter_name %>

<div id="autosave"><%= hidden_field_tag("article[id]", @article.id) if @article.present? %></div>
<div id="article_keywords_auto_complete" class="auto_complete"></div>

<h2 class='page-header'>
  <i class="glyphicon glyphicon-large glyphicon-pencil"></i>
  <%= _("#{controller.action_name.to_s.capitalize} article") %>
  <span class='pull-right'>
    <span id='preview_link'>
      <%= link_to(t(".preview"), {controller: '/articles', action: 'preview', id: @article.id}, {target: 'new', class: 'btn btn-default'}) if @article.id %>
    </span>
    <input id='save_draft' type="submit" value="<%= t('.save_as_draft') %>" name="article[draft]" class='btn btn-default' />
    <%= submit_tag(t(".publish"), :class => 'btn btn-success') %>
  </span>
</h2>

<%= error_messages_for 'article' %>
<div class='row'>
  <div class='col-md-9'>
    <div>
      <%= text_field 'article', 'title', :class => 'form-control', :placeholder => t('.title') %>
    </div>
    <%= render('images', { :images => @images}) unless @images.empty? %>
  
    <div id="editor">
      <i class='glyphicon glyphicon-picture'></i> 
      <span id='image-link'>
        <%= toggle_element('carousel-wrapper', t('.images')) %>
      </span>
      <div id='quicktags'>
        <script type="text/javascript">edToolbar('article_body_and_extended', '<%= @article.text_filter %>');</script>
      </div>

      <div id='simple_editor'>
        <%= text_area('article', 'body_and_extended', {:class => 'form-control', :height => '360px'}) %>
        <%= render 'admin/shared/macros' %>
      </div>
    </div> <!-- End of editor -->
      
    <div class='separator'>
      <h4><%= t(".excerpt") %></h4>
      <%= text_area 'article', 'excerpt', {:height => '150', :class => 'form-control', :rows => '5'} %>
      <span class='help-block'><%=t(".excerpt_explaination") %></span>
    </div>

    <!-- Start of publish settings -->
    <div class='well'>
      <fieldset>
        <legend><%= t(".publish_settings") %></legend>
        
        <!-- Start of status -->
        <div class='control-group'>
          <p>
            <%= t(".status") %>: <strong><%= _(@article.state.to_s.downcase) %></strong>
            <%= toggle_element('status') %>
          </p>
          <div id='status' class='collapse'>
            <label for="article_published" class='checkbox'>
              <%= check_box 'article', 'published'  %>
              <%= t(".published") %>
            </label>
            <p>
              <span class='btn btn-mini btn-default'>
                <%= toggle_element('status', t('.ok')) %>
              </span>
            </p>
          </div>
        </div>
        <!-- End of status -->
        
        <!-- Start of feedback settings -->
        <div class='control-group'>
          <p>
            <%= t(".allowed_comments_and_trackbacks", allow_comment: content_tag(:strong, get_feedback_status(@article.allow_comments)), allow_trackback: content_tag(:strong, get_feedback_status(@article.allow_pings))) %>
            <%= toggle_element('conversation') %>
          </p>
          <div id='conversation' class='collapse'>
            <label for="article_allow_pings" class='checkbox'>
              <%= check_box 'article', 'allow_pings' %>
              <%= t(".allow_trackbacks") %>
            </label>
            <label for="article_allow_comments" class='checkbox'>
              <%= check_box 'article', 'allow_comments' %>
              <%= t(".allow_comments") %>
            </label>
            <p>
              <span class='btn btn-mini btn-default'>
                <%= toggle_element('conversation', t('.ok')) %>
              </span>
            </p>
          </div>
        </div>
        <!-- End of feedback settings -->

        <!-- Start of date publish -->
        <div class='control-group'>
          <p>
            <%= t(".published") %> <strong><%= publish_now_or_already_published @article %></strong>
            <%= toggle_element('publish') %>
          </p>
          <div id='publish' class='collapse'>
            <%= text_field 'article', 'published_at', :class => "datepicker" %>
            <p>
              <span class="btn btn-mini btn-default">
                <%= toggle_element('publish', t('.ok')) %>
              </span>
            </p>
          </div>
        </div>
        <!-- End of date publish -->
        
        <!-- Start of password block -->
        <div class='control-group'>
          <p>
            <%= t(".visibility") %>: <strong><%= @article.password.nil? || @article.password.empty? ? t(".public") : t(".protected") %></strong>
            <%= toggle_element('visibility') %>
          </p>
          <div id='visibility' class='collapse'>
            <label for="article_password"><%= t(".password") %></label>
            <%= text_field 'article', 'published_at', :class => "form-control" %>
            <p>
              <span class="btn btn-mini btn-default">
                <%= toggle_element('visibility', t('.ok')) %>
              </span>
            </p>
            
          </div>
        </div>
        <!-- End of password block -->
        </fieldset>
      </div>
      <!-- End of publish settings -->

      <div class='form-actions'>
        <%- if @article.id.present? && @article.state.to_s.downcase != 'draft' %>
          <%- if current_user.admin? || current_user.id == @article.user_id %>
            <%= link_to(t(".delete"), { action: 'destroy', id: @article.id }, data: {confirm: t(".are_you_sure")}, method: :post, class: 'btn danger', title: t(".delete_content")) %>
          <%- end %>
        <%- end %>
        <span id='destroy_link'><%= link_to_destroy_draft @article %></span>
        <input id='save_draft' type="submit" value="<%= t('.save_as_draft') %>" name="article[draft]" class='btn btn-default' />
        <%= submit_tag(t(".publish"), :class => 'btn btn-success') %>
      </div>
  </div>

<div class='col-md-3'>
  <div class='well'>
    <h4><%= t(".categories") %></h4>
    <%= render 'categories' %>
  </div>
  <div class='well'>
    <h4><%= t(".tags") %></h4>
    <div class='form-group'>
      <%= text_field 'article', 'keywords', {:autocomplete => 'off', :class => 'form-control'} %>
    </div>
    <p class='alert alert-warning'><%=t(".tags_explaination") %></p>
    <%#= auto_complete_field 'article_keywords', { :url => { :action => "auto_complete_for_article_keywords"}, :method => 'get', :tokens => ','}%>		
    
  </div>
  <%= get_post_types %>
</div>
